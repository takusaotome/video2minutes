# E2Eテストシナリオ

## 1. Webアプリケーション E2Eテストシナリオ

### 1.1 基本的なファイルアップロード・処理フロー

#### シナリオ1: 単一動画ファイルの正常処理
**テスト目的**: 基本的な動画→議事録生成フローの動作確認

**前提条件**:
- 有効なOpenAI APIキーとAnthropic APIキーが設定済み
- テスト用動画ファイル（5分程度、MP4形式）が準備済み
- ffmpegがインストール済み

**テスト手順**:
1. ダッシュボード画面を開く
2. ファイルアップロードエリアに動画ファイルをドラッグ&ドロップ
3. アップロード完了トーストが表示されることを確認
4. タスク一覧に新しいタスクが「pending」ステータスで追加されることを確認
5. タスクステータスが「processing」に変更されることを確認
6. 進捗バーが0%から徐々に増加することを確認
7. 処理ステップが順次更新されることを確認:
   - upload → completed
   - audio_extraction → completed
   - transcription → processing → completed
   - minutes_generation → processing → completed
8. 完了時にトースト通知が表示されることを確認
9. タスクステータスが「completed」に変更されることを確認
10. 「議事録を見る」ボタンをクリックして議事録画面に遷移
11. 文字起こしテキストと生成された議事録が表示されることを確認
12. ダウンロードボタンが機能することを確認

**期待結果**:
- 全処理が正常に完了
- 議事録が適切な形式で生成される
- UIが適切に更新される

#### シナリオ2: 複数ファイルの並行処理
**テスト目的**: 複数タスクの並行処理能力確認

**テスト手順**:
1. 3つの異なる動画ファイルを同時にアップロード
2. 3つのタスクが並行して処理されることを確認
3. 各タスクの進捗が独立して更新されることを確認
4. 完了順序が処理時間に応じて変わることを確認
5. 全タスクが正常に完了することを確認

**期待結果**:
- 並行処理が正常に動作
- タスク間で干渉が発生しない

#### シナリオ3: WebSocketリアルタイム更新
**テスト目的**: WebSocket接続によるリアルタイム更新確認

**テスト手順**:
1. ファイルをアップロードしてタスクを開始
2. タスク詳細モーダルを開く
3. WebSocket接続が確立されることを確認（ネットワークタブ）
4. 進捗がリアルタイムで更新されることを確認
5. 処理完了時にWebSocket接続が適切に閉じられることを確認

### 1.2 エラーハンドリングテスト

#### シナリオ4: 無効なファイル形式のアップロード
**テスト手順**:
1. テキストファイル（.txt）をアップロード
2. エラーメッセージが表示されることを確認
3. タスクが作成されないことを確認

#### シナリオ5: ファイルサイズ制限超過
**テスト手順**:
1. 500MBを超える動画ファイルをアップロード
2. ファイルサイズエラーが表示されることを確認

#### シナリオ6: API制限・エラー時の処理
**テスト手順**:
1. 無効なAPIキーを設定
2. ファイルをアップロード
3. 転写処理でエラーが発生することを確認
4. エラー状態がUIに適切に反映されることを確認
5. 再試行ボタンが表示されることを確認

#### シナリオ7: ネットワーク中断時の処理
**テスト手順**:
1. 処理中にネットワーク接続を一時的に切断
2. エラー状態に遷移することを確認
3. ネットワーク復旧後に適切にリカバリされることを確認

### 1.3 UIインタラクションテスト

#### シナリオ8: レスポンシブデザイン
**テスト手順**:
1. デスクトップ、タブレット、モバイル各サイズでアクセス
2. UIコンポーネントが適切にレイアウトされることを確認
3. 全機能がタッチデバイスで操作可能であることを確認

#### シナリオ9: ブラウザ互換性
**テスト手順**:
1. Chrome、Firefox、Safari、Edgeでアクセス
2. 全ブラウザで同等の動作をすることを確認

### 1.4 パフォーマンステスト

#### シナリオ10: 大容量ファイル処理
**テスト手順**:
1. 制限内最大サイズ（500MB）の動画をアップロード
2. メモリ使用量やCPU使用率を監視
3. 処理時間を測定
4. 正常に完了することを確認

#### シナリオ11: 同時アクセス負荷テスト
**テスト手順**:
1. 複数ブラウザ/デバイスから同時アクセス
2. 各セッションが独立して動作することを確認
3. サーバーが適切にリクエストを処理することを確認

## 2. CLIツール E2Eテストシナリオ

### 2.1 基本機能テスト

#### シナリオ12: 正常な議事録生成
**テスト手順**:
```bash
python video2minutes.py -i test_meeting.mp4 --date 2025-01-13 --attendees "田中様, 佐藤様, 鈴木様"
```
1. コマンドが正常に実行される
2. 音声抽出、文字起こし、議事録生成の各ステップが完了
3. transcript/ディレクトリに文字起こしファイルが生成
4. minutes/ディレクトリに議事録ファイルが生成
5. 生成された議事録が適切な形式であることを確認

#### シナリオ13: オプション指定テスト
**テスト手順**:
```bash
python video2minutes.py -i test.mp4 --date 2025-01-13 --attendees "A,B,C" --meeting-name "重要会議" --language en --bitrate 64 --model gpt-4 --keep-audio
```
1. 全オプションが適切に処理される
2. 英語音声が正しく処理される
3. 音声ファイルが保持される
4. 指定したモデルが使用される

### 2.2 エラーハンドリングテスト

#### シナリオ14: 必須パラメータ不足
**テスト手順**:
```bash
python video2minutes.py -i test.mp4
```
1. エラーメッセージが表示される
2. 処理が中断される

#### シナリオ15: 存在しないファイル指定
**テスト手順**:
```bash
python video2minutes.py -i nonexistent.mp4 --date 2025-01-13 --attendees "A,B,C"
```
1. ファイル不存在エラーが表示される

#### シナリオ16: APIキー未設定
**テスト手順**:
1. 環境変数OPENAI_API_KEYを削除
2. CLIを実行
3. APIキーエラーが表示されることを確認

#### シナリオ17: FFmpeg未インストール
**テスト手順**:
1. ffmpegを一時的に利用不可にする
2. CLIを実行
3. 適切なエラーメッセージが表示されることを確認

### 2.3 ファイル処理テスト

#### シナリオ18: 様々なファイル形式対応
**テスト手順**:
1. MP4, AVI, MOV, MKV各形式でテスト実行
2. 全形式で正常に処理されることを確認

#### シナリオ19: 日本語ファイル名対応
**テスト手順**:
1. 日本語ファイル名の動画でテスト実行
2. 正常に処理され、適切なファイル名で出力されることを確認

## 3. 統合テストシナリオ

### 3.1 Webアプリケーション移行準備

#### シナリオ20: CLIとWebアプリの出力一致性確認
**テスト手順**:
1. 同じ動画ファイルをCLIとWebアプリで処理
2. 生成される議事録の内容が一致することを確認
3. 処理時間を比較

#### シナリオ21: 大量ファイル処理性能比較
**テスト手順**:
1. 10個の動画ファイルをCLIで順次処理
2. 同じファイルをWebアプリで並行処理
3. 処理時間とリソース使用量を比較

## 4. セキュリティテスト

#### シナリオ22: ファイルアップロードセキュリティ
**テスト手順**:
1. 悪意のあるファイル（実行ファイル等）のアップロードを試行
2. 適切に拒否されることを確認
3. サーバーが安全に動作し続けることを確認

#### シナリオ23: APIキー漏洩防止
**テスト手順**:
1. ブラウザ開発者ツールでネットワーク通信を監視
2. APIキーがクライアントサイドに漏洩しないことを確認

## 5. テスト実行環境とツール

### 5.1 推奨テスト環境
- **OS**: Windows 10/11, macOS 12+, Ubuntu 20.04+
- **ブラウザ**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **Node.js**: 18+
- **Python**: 3.9+

### 5.2 テストツールスタック
- **E2Eテスト**: Playwright or Cypress
- **API テスト**: pytest + requests
- **パフォーマンステスト**: k6 or Artillery
- **CI/CD**: GitHub Actions

### 5.3 テストデータ
- 短時間動画（1-3分）: 基本機能テスト用
- 中時間動画（5-10分）: 標準的な会議想定
- 長時間動画（30分+）: パフォーマンステスト用
- 様々な音質・言語の動画: 堅牢性テスト用

## 6. テスト実行計画

### 6.1 フェーズ1: 基本機能確認（開発中）
- シナリオ1, 12, 13の実行
- 基本的な動作確認

### 6.2 フェーズ2: エラーハンドリング（実装完了後）
- シナリオ4-7, 14-17の実行
- 異常系の動作確認

### 6.3 フェーズ3: 統合・性能テスト（デプロイ前）
- 全シナリオの実行
- 本番環境での最終確認

### 6.4 継続的テスト（運用開始後）
- 主要シナリオの自動実行
- 定期的な性能監視